/*!
Ratchet Version 1.0.2

Copyright 2012 Gitana Software, Inc.

Licensed under the Apache License, Version 2.0 (the "License"); 
you may not use this file except in compliance with the License. 

You may obtain a copy of the License at 
	http://www.apache.org/licenses/LICENSE-2.0 

Unless required by applicable law or agreed to in writing, software 
distributed under the License is distributed on an "AS IS" BASIS, 
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
See the License for the specific language governing permissions and 
limitations under the License. 

For more information, please contact Gitana Software, Inc. at this
address:

  info@gitanasoftware.com
*/
var Base=function(){};Base.extend=function(b,e){var f=Base.prototype.extend;Base._prototyping=true;var d=new this;f.call(d,b);d.base=function(){};delete Base._prototyping;var c=d.constructor;var a=d.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==a){this._constructing=true;c.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||f).call(arguments[0],d)}}}};a.ancestor=this;a.extend=this.extend;a.forEach=this.forEach;a.implement=this.implement;a.prototype=d;a.toString=this.toString;a.valueOf=function(g){return(g=="object")?a:c.valueOf()};f.call(a,e);if(typeof a.init=="function"){a.init()}return a};Base.prototype={extend:function(b,h){if(arguments.length>1){var e=this[b];if(e&&(typeof h=="function")&&(!e.valueOf||e.valueOf()!=h.valueOf())&&/\bbase\b/.test(h)){var a=h.valueOf();h=function(){var l=this.base||Base.prototype.base;this.base=e;var k=a.apply(this,arguments);this.base=l;return k};h.valueOf=function(k){return(k=="object")?h:a};h.toString=Base.toString}this[b]=h}else{if(b){var g=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){g=this.extend||g}var d={toSource:null};var f=["constructor","toString","valueOf"];var c=Base._prototyping?0:1;while(j=f[c++]){if(b[j]!=d[j]){g.call(this,j,b[j])}}for(var j in b){if(!d[j]){g.call(this,j,b[j])}}}}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,d,c){for(var b in a){if(this.prototype[b]===undefined){d.call(c,a[b],b,a)}}},implement:function(){for(var a=0;a<arguments.length;a++){if(typeof arguments[a]=="function"){arguments[a](this.prototype)}else{this.prototype.extend(arguments[a])}}return this},toString:function(){return String(this.valueOf())}});if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(d){var f={put:function(h,g){(g||window).location.hash=this.encoder(h)},get:function(j){var h=((j||window).location.hash).replace(/^#/,"");try{return d.browser.mozilla?h:decodeURIComponent(h)}catch(g){return h}},encoder:encodeURIComponent};var c={id:"__jQuery_history",init:function(){var g='<iframe id="'+this.id+'" style="display:none" src="javascript:false;" />';d("body").prepend(g);return this},_document:function(){return d("#"+this.id)[0].contentWindow.document},put:function(h){var g=this._document();g.open();g.close();f.put(h,g)},get:function(){return f.get(this._document())}};function e(h){h=d.extend({unescape:false},h||{});f.encoder=j(h.unescape);function j(k){if(k===true){return function(l){return l}}if(typeof k=="string"&&(k=g(k.split("")))||typeof k=="function"){return function(l){return k(encodeURIComponent(l))}}return encodeURIComponent}function g(l){var k=new RegExp(d.map(l,encodeURIComponent).join("|"),"ig");return function(m){return m.replace(k,decodeURIComponent)}}}var b={};b.base={callback:undefined,type:undefined,check:function(){},load:function(g){},init:function(h,g){e(g);a.callback=h;a._options=g;a._init()},_init:function(){},_options:{}};b.timer={_appState:undefined,_init:function(){var g=f.get();a._appState=g;a.callback(g);setInterval(a.check,100)},check:function(){var g=f.get();if(g!=a._appState){a._appState=g;a.callback(g)}},load:function(g){if(g!=a._appState){f.put(g);a._appState=g;a.callback(g)}}};b.iframeTimer={_appState:undefined,_init:function(){var g=f.get();a._appState=g;c.init().put(g);a.callback(g);setInterval(a.check,100)},check:function(){var h=c.get(),g=f.get();if(g!=h){if(g==a._appState){a._appState=h;f.put(h);a.callback(h)}else{a._appState=g;c.put(g);a.callback(g)}}},load:function(g){if(g!=a._appState){f.put(g);c.put(g);a._appState=g;a.callback(g)}}};b.hashchangeEvent={_init:function(){a.callback(f.get());d(window).bind("hashchange",a.check)},check:function(){a.callback(f.get())},load:function(g){f.put(g)}};var a=d.extend({},b.base);if(d.browser.msie&&(d.browser.version<8||document.documentMode<8)){a.type="iframeTimer"}else{if("onhashchange" in window){a.type="hashchangeEvent"}else{a.type="timer"}}d.extend(a,b[a.type]);d.history=a})(jQuery);(function(){window.form2object=function(h,f){h=typeof h=="string"?document.getElementById(h):h;f=f||".";var n=b(h);var s={};var g={};for(var m=0;m<n.length;m++){var o=n[m].value;if(o===""){continue}var e=n[m].name;var l=e.split(f);var p=s;for(var k=0;k<l.length;k++){var q=l[k];var d;if(q.indexOf("[]")>-1&&k==l.length-1){d=q.substr(0,q.indexOf("["));if(!p[d]){p[d]=[]}p[d].push(o)}else{if(q.indexOf("[")>-1){d=q.substr(0,q.indexOf("["));var r=q.replace(/^[a-z]+\[|\]$/gi,"");if(!g[d]){g[d]={}}if(!p[d]){p[d]=[]}if(k==l.length-1){p[d].push(o)}else{if(!g[d][r]){p[d].push({});g[d][r]=p[d][p[d].length-1]}}p=g[d][r]}else{if(k<l.length-1){if(!p[q]){p[q]={}}p=p[q]}else{p[q]=o}}}}}return s};function b(f){var d=[];var g=f.firstChild;while(g){if(g.nodeName.match(/INPUT|SELECT|TEXTAREA/i)){d.push({name:g.name,value:a(g)})}else{var e=b(g);d=d.concat(e)}g=g.nextSibling}return d}function a(d){if(d.nodeName=="INPUT"){if(d.type.toLowerCase()=="radio"||d.type.toLowerCase()=="checkbox"){if(d.checked){return d.value}}else{if(!d.type.toLowerCase().match(/button|reset|submit|image/i)){return d.value}}}else{if(d.nodeName=="TEXTAREA"){return d.innerHTML}else{if(d.nodeName=="SELECT"){return c(d)}}}return""}function c(h){var e=h.multiple;if(!e){return h.value}var d=[];for(var g=h.getElementsByTagName("option"),j=0,f=g.length;j<f;j++){if(g[j].selected){d.push(g[j].value)}}return d}window.form2json=window.form2object})();(function(a){Ratchet=Base.extend({constructor:function(){this.base();var d=this;var c=Ratchet.makeArray(arguments);do{var b=c.shift();if(b){if(Ratchet.isArray(b)&&(Ratchet.isNode(b[0])||Ratchet.isElement(b[0]))){this.el=b[0]}else{if(Ratchet.isNode(b)||Ratchet.isElement(b)){this.el=b}else{if(Ratchet.isFunction(b)){this.setupFunction=b}else{this.parent=b}}}}}while(b);if(!this.el){this.el=document.body}this.childRatchets={};this.authRequiredPatterns=[];this.routes={};this.id=Ratchet.generateId();this.gadgetInstances=[];this.gadgetType=null;this.gadgetStrategy=null;this.subscriptions={};a(this.el).attr("ratchet",this.id);if(!this.parent){this.dispatchCount=0;this.dispatchCompletionCount=0}this.incrementDispatchCount=function(){d.topRatchet().dispatchCount++};this.incrementDispatchCompletionCount=function(){d.topRatchet().dispatchCompletionCount++};this.isDispatchCompleted=function(){return(d.topRatchet().dispatchCompletionCount==d.topRatchet().dispatchCount)};this.executeMatch=function(f,n){var j={};var k=function(){};if(f=="**"){j["**"]=n;k();return j}if((f.indexOf("{")==-1)&&(f.indexOf("*")==-1)){if(f==n){k();return j}}var p=f.split("/");var o=n.split("/");if((p.length==0)&&(o.length==0)){k();return j}do{var g=p.shift();var l=o.shift();var e=(Ratchet.isEmpty(g)||g==="");var h=(Ratchet.isEmpty(l)||l==="");if(!e&&!h){if(g=="*"){}else{if(g=="**"){j["**"]="/"+[].concat(l,o).join("/");break}else{if(Ratchet.startsWith(g,"{")){var m=g.substring(1,g.length-1);j[m]=l}else{if(g==l){}else{return null}}}}}else{if((g&&h)||(e&&l)){return null}}}while(!Ratchet.isEmpty(g)&&!Ratchet.isEmpty(l));k();return j};this.findHandler=function(f){var g=null;var j=null;var k=null;for(var l in d.routes){var e=d.routes[l];if(e.method==f.route.method){j=d.executeMatch(e.uri,f.route.uri);if(j){k=e.handler;break}}}if(k){var h=new Ratchet.RenderContext(this,f.route,null,f.params);Ratchet.copyInto(h.model,f.model);h.tokens=j;g=function(m){return function(){k.call(k,m,m.route.data)}}(h)}else{a("body").trigger("no-match",[f]);var h=new Ratchet.RenderContext(this,f.route,this.el);Ratchet.copyInto(h.model,f.model);h.swap()}return g};this.topRatchet=function(){var e=this;while(e.parent){e=e.parent}return e};this.init()},init:function(){var b=this;if(!this.parent){a.history.init(function(c){if(c==""){}if(c!=""){b.dispatch({method:"GET",uri:"#"+c})}},{unescape:",/#"})}},setup:function(){if(this.setupFunction){this.setupFunction.call(this)}if(a(this.el)[0].nodeName.toLowerCase()=="region"){this.el=Ratchet.convertRegionTag(this.el)}if(a(this.el)[0].nodeName.toLowerCase()=="gadget"){this.el=Ratchet.convertGadgetTag(this.el)}if(!this.gadgetType){this.gadgetType=a(this.el).attr("gadget");this.gadgetId=a(this.el).attr("id");this.gadgetStrategy=null}if(this.gadgetType){this.gadgetInstances=Ratchet.GadgetRegistry.instantiate(this.gadgetType,this.gadgetId,this);a.each(this.gadgetInstances,function(b,c){c.setup.call(c)})}},teardown:function(){var b=this;a.each(this.childRatchets,function(c,d){d.teardown()});a.each(this.childRatchets,function(c,d){delete d});this.childRatchets={};a.each(this.subscriptions,function(c,d){d.unsubscribe(c)});a.each(this.gadgetInstances,function(c,d){d.teardown()});this.gadgetInstances=[];a.each(this.routes,function(d,c){delete b.routes[d]});this.routes={}},processRegions:function(b,e){var c=Ratchet.regionResolver;if(!c){if(Ratchet.isUndefined(Ratchet.DefaultRegionResolver)){Ratchet.error("No default region resolver available");return}else{c=new Ratchet.DefaultRegionResolver("default");Ratchet.regionResolver=c}}a(b.closestDescendants("region")).each(function(){Ratchet.convertRegionTag(this)});var d={};a(b.closestDescendants("[region]")).each(function(){var f=a(this).attr("region");d[f]=this});c.resolve.call(c,this,d,function(h){for(var n in h){var k=h[n];for(var l=0;l<k.length;l++){var j=k[l];var g=j.type;var f=j.id;var m=j.attrs;var o=a("<div gadget='"+g+"'></div>");a.each(m,function(q,p){o.attr(q,p)});if(f){o.attr("id",f)}o.attr("gadget-strategy","replace");a(b.closestDescendants("[region="+n+"]")[0]).replaceWith(o)}}if(e){e.call(this)}})},processGadgets:function(b,e){var d=this;a(b.closestDescendants("gadget")).each(function(){Ratchet.convertGadgetTag(this)});var c={};a(b.closestDescendants("[gadget]")).each(function(){var j=a(this).attr("gadget");var h=a(this).attr("id");var f=a(this).attr("gadget-strategy");var l=false;var g=a(this).attr("ratchet");if(g){var k=d.childRatchets[g];if(k){k.el=this;a(k.el).attr("ratchet",g);l=true}}if(!l){k=new Ratchet(a(this),d,function(){this.gadgetType=j;this.gadgetId=h;this.gadgetStrategy=f});d.childRatchets[k.id]=k;g=k.id}c[g]={};a.each(a(this)[0].attributes,function(n,p){var m=p.name;var o=p.value;if(o){c[g][m]=o}})});a.each(d.childRatchets,function(f,h){var g=c[f];h.dispatch(b.route,g)});if(e){e.call(this)}},get:function(){var b=Ratchet.makeArray(arguments);if(Ratchet.isFunction(b[0])){b.unshift("**")}b.unshift("GET");this.route.apply(this,b)},post:function(){var b=Ratchet.makeArray(arguments);if(Ratchet.isFunction(b[0])){b.unshift("**")}b.unshift("POST");this.route.apply(this,b)},put:function(d,c){var b=Ratchet.makeArray(arguments);if(Ratchet.isFunction(b[0])){b.unshift("**")}b.unshift("PUT");this.route.apply(this,b)},del:function(d,c){var b=Ratchet.makeArray(arguments);if(Ratchet.isFunction(b[0])){b.unshift("**")}b.unshift("DELETE");this.route.apply(this,b)},route:function(){var h=null;var f=null;var c=null;var e=null;var b=Ratchet.makeArray(arguments);if(b.length==2){h=b.shift();f="**";c=b.shift()}else{if(b.length==3){h=b.shift();f=b.shift();c=b.shift()}else{if(b.length==4){h=b.shift();f=b.shift();c=b.shift();e=b.shift()}else{Ratchet.error("Wrong number of arguments");return}}}if(!e){e=c}var d=function(k,j){return function(l,m){j.call(k,l,m)}}(e,c);var g=h+"-"+f;this.routes[g]={uri:f,method:h,handler:d}},dispatch:function(b,d){var e=this;this.teardown();this.setup();if(Ratchet.startsWith(b.uri,"#")){b.uri=b.uri.substring(1)}var c=new Ratchet.RenderContext(this,b,null,d);this.incrementDispatchCount();this.ensureAuthentication.call(this,c,function(){var f=e.findHandler(c);if(f){f()}},function(){alert("Authentication failed - not authenticated")})},run:function(){var e={method:"GET",data:{}};var d=Ratchet.makeArray(arguments);if(d.length==0){uri=window.location.href;if(uri.indexOf("#")>-1){uri=uri.substring(uri.indexOf("#")+1)}else{uri="/"}e.uri=uri}else{if(d.length==1){e.uri=d.shift()}else{if(d.length==2){var c=d.shift();var b=d.shift();if(Ratchet.isString(b)){e.method=c;e.uri=b}else{e.uri=c;e.data=b}}else{if(d.length==3){e.method=d.shift();e.uri=d.shift();e.data=d.shift()}}}}if(e.method=="GET"&&!this.parent){a.history.load(e.uri)}else{this.dispatch(e)}},observable:function(){var e;var h;var b;var d;var c=Ratchet.makeArray(arguments);if(c.length==1){e="global";h=c.shift()}else{if(c.length==2){e=c.shift();h=c.shift()}else{if(c.length==3){e="global";h=c.shift();b=c.shift();d=c.shift()}else{if(c.length==4){e=c.shift();h=c.shift();b=c.shift();d=c.shift()}}}}var g=Ratchet.ScopedObservables.get(e);var f=g.observable(h);if(b&&d){f.subscribe(b,d);this.subscriptions[b]=f}return f},dependentObservable:function(){var c=null;var f=null;var d=null;var b=Ratchet.makeArray(arguments);if(b.length==2){c="global";f=b.shift();d=b.shift()}else{if(b.length==3){c=b.shift();f=b.shift();d=b.shift()}else{Ratchet.error("Wrong number of arguments");return}}var e=Ratchet.ScopedObservables.get(c);return e.dependentObservable(f,d)},requireAuthentication:function(b){this.authRequiredPatterns.push(b)},ensureAuthentication:function(d,b,h){var j=this;if(this.authRequiredPatterns.length==0){b()}else{var g=false;for(var c=0;c<this.authRequiredPatterns.length;c++){var e=this.authRequiredPatterns[c];var f=this.executeMatch(e,d.route.uri);if(f){g=true}}if(g){if(this.authenticator&&this.authenticator.authenticate){this.authenticator.authenticate(d,function(){b()},function(){h()})}else{this.authenticate.call(j,d,function(){b()},function(){h()})}}else{b()}}},authenticate:function(c,b,d){b()},select:function(b){var f=null;var d=this.topRatchet();for(var c in d.childRatchets){var e=d.childRatchets[c];if(e.gadgetType==b){f=e;break}}return f},hide:function(){a(this.el).css("display","none")},show:function(){a(this.el).css("display","block")},findGadget:function(e,f){var b=null;for(var d=0;d<this.gadgetInstances.length;d++){var c=this.gadgetInstances[d];if(c.type==e&&c.id==f){b=c;break}}return b}});Ratchet.convertGadgetTag=function(c){var b=a(c).attr("tag");if(!b){b="div"}var e=a(c).attr("type");var b=a("<"+b+" gadget='"+e+"'></"+b+">");a.each(a(c)[0].attributes,function(j,g){var h=g.nodeName;var k=g.nodeValue;if(h=="strategy"){h="gadget-strategy"}if(h=="tag"||h=="type"){}else{a(b).attr(h,k)}});var f="temp-"+new Date().getTime();a(b).attr("tempkey",f);a(b).html(a(c).html());var d=a(c).parent();a(c).replaceWith(b);b=a(d).children("[tempkey="+f+"]")[0];a(b).removeAttr("tempkey");return b};Ratchet.convertRegionTag=function(c){var b=a(c).attr("tag");if(!b){b="div"}var f=a(c).attr("id");var b=a("<"+b+" region='"+f+"'></"+b+">");var e="temp-"+new Date().getTime();a(b).attr("tempkey",e);a.each(a(c)[0].attributes,function(j,g){var h=g.nodeName;var k=g.nodeValue;if(h=="tag"||h=="region"){}else{a(b).attr(h,k)}});var d=a(c).parent();a(c).replaceWith(b);b=a(d).children("[tempkey="+e+"]")[0];a(b).removeAttr("tempkey");return b};if(typeof Ratchet.Gadgets==="undefined"){Ratchet.Gadgets={}}if(typeof Ratchet.Pages==="undefined"){Ratchet.Pages={}}if(typeof Ratchet.Utils==="undefined"){Ratchet.Utils={}}if(typeof Ratchet.Authenticators==="undefined"){Ratchet.Authenticators={}}})(jQuery);(function(){Ratchet.uniqueIdCounter=0;Ratchet.makeArray=function(a){return Array.prototype.slice.call(a)};Ratchet.stringify=function(a,b){var c=null;if(b){c=JSON.stringify(a,null,"  ")}else{c=JSON.stringify(a)}return c};Ratchet.isString=function(a){return(typeof a=="string")};Ratchet.isFunction=function(a){return Object.prototype.toString.call(a)==="[object Function]"};Ratchet.startsWith=function(b,a){return b.substr(0,a.length)===a};Ratchet.copyInto=function(c,b){for(var a in b){if(b.hasOwnProperty(a)&&!this.isFunction(this[a])){c[a]=b[a]}}};Ratchet.isArray=function(a){return a.push&&a.slice};Ratchet.isUndefined=function(a){return(typeof a=="undefined")};Ratchet.isEmpty=function(a){return this.isUndefined(a)||a==null};Ratchet.generateId=function(){Ratchet.uniqueIdCounter++;return"ratchet-"+Ratchet.uniqueIdCounter};Ratchet.isNode=function(a){return(typeof Node==="object"?a instanceof Node:typeof a==="object"&&typeof a.nodeType==="number"&&typeof a.nodeName==="string")};Ratchet.isElement=function(a){return(typeof HTMLElement==="object"?a instanceof HTMLElement:typeof a==="object"&&a.nodeType===1&&typeof a.nodeName==="string")};Ratchet.debug=function(a){if(!this.isUndefined(console)){console.log(a)}};Ratchet.error=function(a){if(!this.isUndefined(console)){console.error(a)}};Ratchet.copyAttributes=function(c,f){for(var b=0;b<$(c)[0].attributes.length;b++){var d=$(c)[0].attributes[b].name;var e=$(c)[0].attributes[b].value;$(f).attr(d,e)}};Ratchet.params=function(){var a={};if(window.location.href.indexOf("?")==-1){return a}var e=window.location.href.split("?")[1].split("&"),c=e.length,d;if(e[0]){for(var b=0;b<c;b++){d=e[b].split("=");d[0]=decodeURIComponent(d[0]);d[1]=d[1]?decodeURIComponent(d[1]):true;a[d[0]]=d[1]}}return a};Ratchet.hashParam=function(b){var a=window.location.href.substring(window.location.href.indexOf("#")+1);var c=a.split("&");for(i=0;i<c.length;i++){val=c[i].split("=");if(val[0]==b){return unescape(val[1])}}return null}})(window);(function(a){Ratchet.Observable=Base.extend({constructor:function(b,d){var c=this;this.base();this.id=b+"-"+d;this.value=null;this.subscribers={};this.dependentOnUs={};this.notifySubscribers=function(){var e=this;a.each(this.subscribers,function(g,f){f(e.value)})};this.notifyDependents=function(){a.each(this.dependentOnUs,function(f,e){e.onDependencyChange()})};this.valueFunction=null},setValueFunction:function(b){this.valueFunction=b;this.onDependencyChange()},subscribe:function(c,b){if(!this.isSubscribed(c)){this.subscribers[c]=b}},unsubscribe:function(b){delete this.subscribers[b]},isSubscribed:function(b){return this.subscribers[b]},markDependentOnUs:function(b){this.dependentOnUs[b.id]=b},onDependencyChange:function(){var b=this.get();if(this.valueFunction){var c=this.valueFunction();if(b!=c){this.set(c)}}},set:function(b){this.value=b;this.notifyDependents();this.notifySubscribers()},get:function(b){var c=this.value;if(!c){c=b}return c},clear:function(){delete this.value;this.notifyDependents();this.notifySubscribers()}})})(jQuery);(function(a){Ratchet.Observables=Base.extend({constructor:function(b){this.base();this.scope=b;this.observables={}},observable:function(d,b){if(!this.observables[d]){var c=new Ratchet.Observable(this.scope,d);if(b){c.set(b)}this.observables[d]=c}return this.observables[d]},dependentObservable:function(g,c){var f=this;if(!this.observables[g]){var e=this.observable(g);var b=new Ratchet.Observables(this.scope);b.observable=function(h,k){var j=f.observable(h,k);j.markDependentOnUs(e);return j};var d=function(){return c.call(b)};e.setValueFunction(d)}return this.observables[g]},observables:function(){return this.observables}})})(jQuery);(function(a){Ratchet.ScopedObservables={};Ratchet.ScopedObservables.map={};Ratchet.ScopedObservables.get=function(b){if(!Ratchet.ScopedObservables.map[b]){Ratchet.ScopedObservables.map[b]=new Ratchet.Observables(b)}return Ratchet.ScopedObservables.map[b]}})(jQuery);(function(a){Ratchet.RenderContext=Base.extend({constructor:function(f,d,c,e){this.base();var b=a("<div></div>");if(c){b.html(a(c).html())}jQuery.extend(this,b,{route:d});this.ratchet=function(){return f};this.topRatchet=function(){return this.ratchet().topRatchet()};this._getContainer=function(){return b};this.children=function(){return b.children()};this.model={};this.params=(e?e:{})},swap:function(c){var b=this;b.ratchet().processRegions.call(b.ratchet(),b,function(){b.ratchet().processGadgets.call(b.ratchet(),b,function(){var n=function(){a("body").trigger("swap",[b.ratchet()]);b.ratchet().incrementDispatchCompletionCount();a("body").trigger("dispatch",[b.ratchet(),b.ratchet().isDispatchCompleted()]);if(c){c.call(b)}};var g=this.gadgetStrategy;if(!g){g="insert"}if(g=="replace"){var j=null;if(b.children().size()>0){var k=0;while(k<b[0].childNodes.length){var l=b[0].childNodes[k];if(l.nodeName=="#text"){if(l.textContent.trim()==0){b[0].removeChild(l)}else{k++}}else{k++}}if(b[0].childNodes[0].nodeName.toLowerCase()==b.children()[0].nodeName.toLowerCase()){j=b.children()[0]}}if(j){var d=a(j)[0].nodeName;if(a(b.ratchet().el)[0].nodeName.toLowerCase()=="body"){d="body"}var f=a("<"+d+"></"+d+">");var h=a(b.ratchet().el).prop("attributes");a.each(h,function(){if(this.name=="gadget"||this.name=="gadget-strategy"){}else{a(f).attr(this.name,this.value)}});var h=a(j).prop("attributes");a.each(h,function(){a(f).attr(this.name,this.value)});a(f).append(a(j)[0].childNodes);var e="tempkey-"+new Date().getTime();a(f).attr("tempkey",e);var m=a(b.ratchet().el).parent();a(b.ratchet().el).replaceWith(f);f=a(m).find("[tempkey="+e+"]");a(f).removeAttr("tempkey");b.ratchet().el=a(f)[0];n();return}a(b.ratchet().el).replaceWith(a(b)[0].childNodes);b.ratchet().el=null;n();return}a(b.ratchet().el).html("");a(b.ratchet().el).append(a(b)[0].childNodes);n()})})},fetch:function(){var j=this;var f=Ratchet.makeArray(arguments);var e=f.shift();var d=null;var b=null;var h=null;var c=f.shift();if(Ratchet.isFunction(c)){b=c;h=f.shift()}else{d=c;b=f.shift();h=f.shift()}if(!d){d={}}var g=(e.match(/\.json$/)||d.json);a.ajax(a.extend({url:e,data:{},dataType:(g?"json":null),type:"get",success:function(k){if(b){b.call(b,j,k)}},failure:function(k){if(h){h.call(h,j,k)}}},d))},transform:function(p,j,f,d){var l=this;var m=Ratchet.makeArray(arguments);var p=m.shift();var k=this.model;var f=null;var d=null;var e=m.shift();if(Ratchet.isFunction(e)){f=e;d=m.shift()}else{j=e;Ratchet.copyInto(k,j);f=m.shift();d=m.shift()}var o=null;if(Ratchet.renditionEngineId){o=Ratchet.TemplateEngineRegistry.find(Ratchet.renditionEngineId);if(!o){Ratchet.error("Unable to find desired rendition engine (Ratchet.renditionEngineId): "+Ratchet.renditionEngineId);return}}else{var b=Ratchet.TemplateEngineRegistry.getIds();for(var h=0;h<b.length;h++){o=Ratchet.TemplateEngineRegistry.find(b[h])}if(!o){Ratchet.error("Unable to find a default rendition engine as none are configured");return}}var c="url";var n=p;var g=null;if(p.indexOf("#")==0){c="selector"}else{if(p.indexOf("<")>-1||p.indexOf(" ")>-1){c="html"}}o.render(l,c,n,g,k,function(q){if(f){f(q)}},function(r,q){if(d){d(r,q)}})},observable:function(){var g;var h;var f;var e=Ratchet.makeArray(arguments);if(e.length==1){g="global";h=e.shift()}else{if(e.length==2){var d=e.shift();var c=e.shift();if(Ratchet.isFunction(c)){g="global";h=d;f=c}else{g=d;h=c}}else{if(e.length==3){g=e.shift();h=e.shift();f=e.shift()}}}var b=this.id;return this.ratchet().observable(g,h,b,f)},dependentObservable:function(){return this.ratchet().dependentObservable.apply(this.ratchet(),arguments)},subscribe:function(){var b=Ratchet.makeArray(arguments);var d=null;var f=null;var c=null;if(b.length==2){d="global";f=b.shift();c=b.shift()}else{d=b.shift();f=b.shift();c=b.shift()}var e=function(g){return function(){c.call(g)}}(this);this.ratchet().observable(d,f,e)},run:function(){this.ratchet().run.apply(this.ratchet(),arguments)}})})(jQuery);(function(a){Ratchet.Gadget=Base.extend({constructor:function(b,c,e){this.base();var d=this;this.type=b;this.id=e;if(!this.id){this.id=this.type}this.route=function(j,k,g,h){if(Ratchet.isString(g)){var f=g;g=function(m,l){d.renderTemplate.call(d,m,l,f)}}c.route(this,j,k,g,h)};this.ratchet=function(){return c};this.topRatchet=function(){var f=this.ratchet();while(f.parent){f=f.parent}return f};this.getGadgetId=function(){return this.id};this.getGadgetType=function(){return this.type}},app:function(){return this.topRatchet()},setup:function(){},teardown:function(){},subscribe:function(){var b=Ratchet.makeArray(arguments);var d=null;var f=null;var c=null;if(b.length==2){d="global";f=b.shift();c=b.shift()}else{d=b.shift();f=b.shift();c=b.shift()}var e=function(g){return function(){c.call(g)}}(this);this.observable(d,f,e)},observable:function(){var g;var h;var f;var e=Ratchet.makeArray(arguments);if(e.length==1){g="global";h=e.shift()}else{if(e.length==2){var d=e.shift();var c=e.shift();if(Ratchet.isFunction(c)){g="global";h=d;f=c}else{g=d;h=c}}else{if(e.length==3){g=e.shift();h=e.shift();f=e.shift()}}}var b=this.ratchet().id+"-"+this.getGadgetId();return this.ratchet().observable(g,h,b,f)},dependentObservable:function(){return this.ratchet().dependentObservable.apply(this.ratchet(),arguments)},refreshHandler:function(b){return function(c){return function(){c.run(c.route.method,c.route.uri,c.route.data)}}(b)},run:function(){this.ratchet().run.apply(this.ratchet(),arguments)},get:function(){var b=Ratchet.makeArray(arguments);b.push(this);this.ratchet().get.apply(this.ratchet(),b)},post:function(){var b=Ratchet.makeArray(arguments);b.push(this);this.ratchet().post.apply(this.ratchet(),b)},put:function(c,b){var d=Ratchet.makeArray(arguments);d.push(this);this.ratchet().put.apply(this.ratchet(),d)},del:function(c,b){var d=Ratchet.makeArray(arguments);d.push(this);this.ratchet().del.apply(this.ratchet(),d)},select:function(b){return this.ratchet().select(b)}})})(jQuery);(function(a){Ratchet.GadgetRegistry={};Ratchet.GadgetRegistry.registry={};Ratchet.GadgetRegistry.register=function(b,c){if(!Ratchet.GadgetRegistry.registry[b]){Ratchet.GadgetRegistry.registry[b]=[]}Ratchet.GadgetRegistry.registry[b].push(c);return c};Ratchet.GadgetRegistry.instantiate=function(c,f,e){var d=[];var b=Ratchet.GadgetRegistry.registry[c];if(b){a.each(b,function(h,j){var g=new j(c,e,f);d.push(g)})}return d.reverse()}})(jQuery);(function(){Ratchet.TemplateEngineRegistry={};Ratchet.TemplateEngineRegistry.registry={};Ratchet.TemplateEngineRegistry.register=function(b,a){Ratchet.TemplateEngineRegistry.registry[b]=a};Ratchet.TemplateEngineRegistry.find=function(a){return Ratchet.TemplateEngineRegistry.registry[a]};Ratchet.TemplateEngineRegistry.getIds=function(){var a=[];for(var b in Ratchet.TemplateEngineRegistry.registry){a.push(b)}return a}})();(function(a){if(typeof(Ratchet.TemplateCache)=="undefined"){Ratchet.TemplateCache={}}Ratchet.BaseTemplateEngine=Base.extend({constructor:function(b){this.base();this.id=b;this.cleanMarkup=function(d,c){var e=a(c);if(a(e).length==1){if(a(e)[0].nodeName.toLowerCase()=="script"){c=a(e).html()}}return c}},renderUri:function(d,e,c,b,f){return this.render(d,"uri",e,e,c,b,f)},render:function(d,k,m,j,h,e,c){var n=this;var l=function(p,o){if(p){c.call(c,p);return}a(d).html("");a(d).append(o);if(e){e.call(e,d)}};if(k=="selector"||k=="html"){var g=m;if(k=="selector"){g=a(d).select(m).html()}this.doRender(d,j,g,h,l)}else{if(k=="url"||k=="uri"){var f=n.fileExtension();var b=m;if(b.indexOf("."+f)==-1){b+="."+f}a.ajax({url:b,dataType:"html",success:function(o){o=n.cleanMarkup(d,o);n.doRender(d,j,o,h,l)},failure:function(o){if(c){c.call(c,d,o)}}})}else{c.call(c,new Error("Unknown render type: "+k))}}},fileExtension:function(){return"html"},doRender:function(e,c,d,b,f){}})})(jQuery);(function(a){Ratchet.AbstractAuthenticator=Base.extend({constructor:function(b){this.config=b},init:function(){},authenticate:function(c,b,d){},logout:function(b,c){}})})(jQuery);(function(a){a.ratchet=Ratchet;a.fn.ratchet=function(b){return new Ratchet(this[0],b)};a.fn.serializeObject=function(){return window.form2object(this[0])};a.fn.closestDescendants=function(c){if(!c||c==""){return a()}var d=[];var b=function(g){if(g.is(c)){d.push(g);return}var f=g.children();for(var e=0;e<f.length;e++){b(a(f[e]))}};b(this);return a(d)}})(jQuery);(function(a){Ratchet.DefaultRegionResolver=Base.extend({constructor:function(b){this.base();this.id=b},resolve:function(c,g,k){var l=this;var h=Ratchet.regionMappings;if(!h){h={}}var e={};for(var b in g){var d=h[b];if(d){var j=[];var f={type:d,attrs:{}};j.push(f);e[b]=j}}k.call(l,e)}})})(jQuery);